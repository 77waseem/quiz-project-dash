<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/png" href="cairo.jpg">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Admin Dashboard</title>
    <style>
        /* ==================== RESET & BASE STYLES ==================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0a0a0f;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
            color: #fff;
        }

        /* ==================== ANIMATED BACKGROUND ==================== */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at top left, rgba(138, 43, 226, 0.15), transparent 50%),
                        radial-gradient(ellipse at bottom right, rgba(0, 191, 255, 0.15), transparent 50%);
            animation: backgroundPulse 20s ease-in-out infinite;
            z-index: -2;
        }

        body::after {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(138, 43, 226, 0.08) 0%, transparent 50%);
            animation: rotate 30s linear infinite;
            z-index: -1;
        }

        @keyframes backgroundPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* ==================== SCROLLBAR STYLES ==================== */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(10, 10, 20, 0.6);
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #8a2be2, #00bfff);
            border-radius: 6px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #00bfff, #8a2be2);
        }

        /* ==================== LOADING SCREEN ==================== */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 15, 0.98);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(10px);
        }

        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 6px solid rgba(138, 43, 226, 0.3);
            border-top: 6px solid #8a2be2;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: #00bfff;
            font-size: 1.3rem;
            margin-top: 25px;
            font-weight: 600;
        }

        /* ==================== LOGIN SCREEN ==================== */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-card {
            background: rgba(15, 15, 25, 0.95);
            border-radius: 24px;
            padding: 45px;
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.8), 
                        0 0 0 1px rgba(138, 43, 226, 0.3);
            width: 100%;
            max-width: 420px;
            border: 1px solid rgba(138, 43, 226, 0.4);
            animation: loginSlideUp 0.7s cubic-bezier(0.34, 1.56, 0.64, 1);
            backdrop-filter: blur(20px);
        }

        @keyframes loginSlideUp {
            from { opacity: 0; transform: translateY(50px) scale(0.9); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .login-header {
            text-align: center;
            margin-bottom: 35px;
        }

        .login-header h1 {
            color: #00bfff;
            font-size: 2.3rem;
            margin-bottom: 12px;
            font-weight: 800;
            background: linear-gradient(135deg, #8a2be2, #00bfff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: titleShine 3s ease-in-out infinite;
        }

        @keyframes titleShine {
            0%, 100% { filter: drop-shadow(0 0 20px rgba(138, 43, 226, 0.6)); }
            50% { filter: drop-shadow(0 0 30px rgba(0, 191, 255, 0.8)); }
        }

        .login-header p {
            color: #8a2be2;
            font-size: 1.05rem;
            font-weight: 600;
        }

        /* ==================== FORM ELEMENTS ==================== */
        .form-group {
            margin-bottom: 22px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            color: #00bfff;
            font-weight: 600;
            font-size: 0.95rem;
        }

        .form-group input, 
        .form-group textarea, 
        .form-group select {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid rgba(138, 43, 226, 0.3);
            border-radius: 12px;
            font-size: 1rem;
            background: rgba(10, 10, 20, 0.8);
            color: #fff;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
        }

        .form-group input:focus, 
        .form-group textarea:focus, 
        .form-group select:focus {
            outline: none;
            border-color: #00bfff;
            box-shadow: 0 0 0 4px rgba(0, 191, 255, 0.15),
                        0 8px 16px rgba(0, 191, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .form-group input:disabled {
            background: rgba(20, 20, 30, 0.8);
            color: #aaa;
            cursor: not-allowed;
        }


        .form-group textarea {
            min-height: 110px;
            resize: vertical;
            font-family: inherit;
        }

        /* ==================== BUTTONS ==================== */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            font-size: 0.95rem;
        }

        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.25);
            transform: translate(-50%, -50%);
            transition: width 0.4s, height 0.4s;
        }

        .btn:hover::after {
            width: 250px;
            height: 250px;
        }

        .btn-login {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #8a2be2 0%, #00bfff 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.15rem;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 8px 24px rgba(138, 43, 226, 0.4);
            border: 3px solid rgba(0, 191, 255, 0.4);
        }

        .btn-login:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 32px rgba(138, 43, 226, 0.6);
        }

        .btn-primary {
            background: linear-gradient(135deg, #8a2be2 0%, #00bfff 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(138, 43, 226, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 28px rgba(138, 43, 226, 0.6);
        }

        .btn-success {
            background: linear-gradient(135deg, #00bfff, #00d4ff);
            color: white;
            box-shadow: 0 6px 20px rgba(0, 191, 255, 0.4);
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 28px rgba(0, 191, 255, 0.6);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff3366, #ff6b8a);
            color: white;
            box-shadow: 0 6px 20px rgba(255, 51, 102, 0.4);
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 28px rgba(255, 51, 102, 0.6);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffa500, #ffb733);
            color: white;
            box-shadow: 0 6px 20px rgba(255, 165, 0, 0.4);
        }

        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 28px rgba(255, 165, 0, 0.6);
        }

        .btn-logout {
            padding: 10px 24px;
            background: linear-gradient(135deg, #ff3366, #ff6b8a);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(255, 51, 102, 0.3);
        }

        .btn-logout:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 51, 102, 0.5);
        }

        /* ==================== ALERTS & MESSAGES ==================== */
        .error-message {
            color: #ff3366;
            text-align: center;
            margin-top: 18px;
            display: none;
            animation: errorShake 0.5s;
            font-weight: 600;
        }

        @keyframes errorShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-12px); }
            75% { transform: translateX(12px); }
        }

        .error-message.show {
            display: block;
        }

        .alert {
            padding: 18px 24px;
            border-radius: 12px;
            margin-bottom: 22px;
            font-weight: 600;
            animation: alertSlide 0.5s;
        }

        @keyframes alertSlide {
            from { opacity: 0; transform: translateY(-15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .alert-success {
            background: rgba(0, 191, 255, 0.2);
            color: #00bfff;
            border: 1px solid #00bfff;
        }

        .alert-error {
            background: rgba(255, 51, 102, 0.2);
            color: #ff3366;
            border: 1px solid #ff3366;
        }

        /* ==================== DASHBOARD LAYOUT ==================== */
        .dashboard {
            display: none;
        }

        .dashboard.active {
            display: block;
            animation: dashboardFade 0.5s;
        }

        @keyframes dashboardFade {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* ==================== NAVBAR ==================== */
        .navbar {
            background: rgba(15, 15, 25, 0.95);
            box-shadow: 0 4px 30px rgba(138, 43, 226, 0.3);
            padding: 18px 35px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid rgba(138, 43, 226, 0.3);
            backdrop-filter: blur(20px);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .navbar-brand {
            font-size: 1.6rem;
            font-weight: 800;
            background: linear-gradient(135deg, #8a2be2, #00bfff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: brandSlide 0.6s ease-out;
        }

        @keyframes brandSlide {
            from { opacity: 0; transform: translateX(-40px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .navbar-user {
            display: flex;
            align-items: center;
            gap: 22px;
            animation: userSlide 0.6s ease-out;
        }

        @keyframes userSlide {
            from { opacity: 0; transform: translateX(40px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 52px;
            height: 52px;
            border-radius: 50%;
            background: linear-gradient(135deg, #8a2be2 0%, #00bfff 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            box-shadow: 0 6px 20px rgba(138, 43, 226, 0.5);
            overflow: hidden;
            border: 3px solid rgba(0, 191, 255, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .user-avatar:hover {
            transform: scale(1.12) rotate(8deg);
            box-shadow: 0 8px 30px rgba(138, 43, 226, 0.7);
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-name {
            color: #00bfff;
            font-weight: 700;
            font-size: 1.05rem;
        }

        .user-role {
            font-size: 0.88rem;
            color: #8a2be2;
            font-weight: 600;
        }

        /* ==================== CONTAINER & TABS ==================== */
        .container {
            max-width: 1450px;
            margin: 0 auto;
            padding: 35px;
        }

        .tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 35px;
            border-bottom: 2px solid rgba(138, 43, 226, 0.3);
            flex-wrap: wrap;
            padding-bottom: 2px;
        }

        .tab {
            padding: 14px 28px;
            background: rgba(15, 15, 25, 0.6);
            color: #00bfff;
            border: 1px solid rgba(138, 43, 226, 0.3);
            border-radius: 12px 12px 0 0;
            cursor: pointer;
            font-size: 1.02rem;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .tab::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 4px;
            background: linear-gradient(90deg, #8a2be2, #00bfff);
            transition: width 0.3s;
        }

        .tab:hover::before {
            width: 100%;
        }

        .tab:hover {
            background: rgba(138, 43, 226, 0.2);
            transform: translateY(-3px);
        }

        .tab.active {
            background: linear-gradient(135deg, #8a2be2 0%, #00bfff 100%);
            color: white;
            border-color: transparent;
            box-shadow: 0 6px 20px rgba(138, 43, 226, 0.5);
            transform: translateY(-3px);
        }

        .tab.active::before {
            width: 100%;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: tabScale 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        @keyframes tabScale {
            from { opacity: 0; transform: scale(0.96); }
            to { opacity: 1; transform: scale(1); }
        }

        /* ==================== SECTION HEADER ==================== */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 18px;
            border-bottom: 2px solid rgba(138, 43, 226, 0.3);
            flex-wrap: wrap;
            gap: 15px;
        }

        .section-header h2 {
            color: #00bfff;
            font-size: 1.9rem;
            font-weight: 800;
            text-shadow: 0 0 15px rgba(0, 191, 255, 0.4);
        }

        /* ==================== STATS GRID ==================== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 24px;
            margin-bottom: 35px;
        }

        .stat-card {
            background: rgba(15, 15, 25, 0.85);
            color: white;
            padding: 30px;
            border-radius: 18px;
            box-shadow: 0 12px 40px rgba(138, 43, 226, 0.4);
            border: 1px solid rgba(138, 43, 226, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            animation: statSlide 0.6s ease-out;
        }

        @keyframes statSlide {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(138, 43, 226, 0.15) 0%, transparent 70%);
            animation: statRotate 15s linear infinite;
        }

        @keyframes statRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 18px 50px rgba(138, 43, 226, 0.6);
        }

        .stat-card:nth-child(1) { border-top: 4px solid #8a2be2; }
        .stat-card:nth-child(2) { border-top: 4px solid #00bfff; }
        .stat-card:nth-child(3) { border-top: 4px solid #8a2be2; }
        .stat-card:nth-child(4) { border-top: 4px solid #00bfff; }

        .stat-value {
            font-size: 2.8rem;
            font-weight: 900;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #8a2be2, #00bfff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
            z-index: 1;
        }

        .stat-label {
            font-size: 1.05rem;
            opacity: 0.95;
            color: #00bfff;
            position: relative;
            z-index: 1;
            font-weight: 600;
        }

        /* ==================== QUESTIONS ==================== */
        .question-list {
            display: grid;
            gap: 22px;
        }

        .question-card {
            background: rgba(15, 15, 25, 0.85);
            border-radius: 16px;
            padding: 24px;
            border-left: 5px solid #8a2be2;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            animation: cardSlide 0.5s ease-out;
            border: 1px solid rgba(138, 43, 226, 0.3);
            backdrop-filter: blur(10px);
        }

        @keyframes cardSlide {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .question-card:hover {
            box-shadow: 0 12px 40px rgba(138, 43, 226, 0.4);
            transform: translateX(-8px);
            border-left-color: #00bfff;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 18px;
        }

        .question-id {
            background: linear-gradient(135deg, #8a2be2 0%, #00bfff 100%);
            color: white;
            padding: 6px 16px;
            border-radius: 25px;
            font-weight: 700;
            font-size: 0.92rem;
            box-shadow: 0 4px 15px rgba(138, 43, 226, 0.4);
        }

        .question-actions {
            display: flex;
            gap: 12px;
        }

        .question-text {
            font-size: 1.15rem;
            color: #00bfff;
            margin-bottom: 18px;
            font-weight: 600;
            line-height: 1.6;
        }

        .choices-list {
            display: grid;
            gap: 10px;
            margin-bottom: 18px;
        }

        .choice-item {
            padding: 12px 18px;
            background: rgba(10, 10, 20, 0.7);
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
            border: 1px solid rgba(138, 43, 226, 0.3);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .choice-item:hover {
            background: rgba(138, 43, 226, 0.15);
            transform: translateX(8px);
        }

        .choice-item.correct {
            background: rgba(0, 191, 255, 0.15);
            border: 2px solid #00bfff;
        }

        .choice-badge {
            background: linear-gradient(135deg, #8a2be2 0%, #00bfff 100%);
            color: white;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 700;
        }

        .choice-text {
            color: #fff;
            font-weight: 500;
        }

        .correct-badge {
            background: #00bfff;
            color: #0a0a0f;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 700;
            box-shadow: 0 0 15px rgba(0, 191, 255, 0.6);
        }

        .choices-editor {
            margin-bottom: 22px;
        }

        .choice-editor {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
            align-items: center;
        }

        .choice-editor input[type="text"] {
            flex: 1;
        }

        .choice-editor input[type="radio"] {
            width: 22px;
            height: 22px;
            cursor: pointer;
            accent-color: #8a2be2;
        }

        .btn-add-choice {
            width: 100%;
            padding: 12px;
            background: rgba(138, 43, 226, 0.15);
            color: #8a2be2;
            border: 2px dashed #8a2be2;
            font-weight: 600;
        }

        .btn-add-choice:hover {
            background: rgba(138, 43, 226, 0.25);
            border-color: #00bfff;
            color: #00bfff;
        }

        /* ==================== TABLES ==================== */
        .results-table, .codes-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 22px;
            background: rgba(15, 15, 25, 0.85);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.5);
        }

        .results-table th,
        .results-table td,
        .codes-table th,
        .codes-table td {
            padding: 16px;
            text-align: right;
            border-bottom: 1px solid rgba(138, 43, 226, 0.3);
        }

        .results-table th,
        .codes-table th {
            background: rgba(138, 43, 226, 0.25);
            font-weight: 700;
            color: #00bfff;
            font-size: 1.05rem;
        }

        .results-table td,
        .codes-table td {
            color: #fff;
            font-weight: 500;
        }

        .results-table tr:hover,
        .codes-table tr:hover {
            background: rgba(138, 43, 226, 0.15);
        }

        /* ==================== BADGES ==================== */
        .score-badge {
            padding: 6px 16px;
            border-radius: 25px;
            font-weight: 700;
            display: inline-block;
        }

        .score-excellent {
            background: linear-gradient(135deg, #00bfff, #00d4ff);
            color: white;
        }

        .score-good {
            background: linear-gradient(135deg, #8a2be2, #a855f7);
            color: white;
        }

        .score-average {
            background: linear-gradient(135deg, #ffa500, #ffb733);
            color: white;
        }

        .score-poor {
            background: linear-gradient(135deg, #ff3366, #ff6b8a);
            color: white;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-available {
            background: rgba(0, 191, 255, 0.2);
            color: #00bfff;
            border: 1px solid #00bfff;
        }

        .status-used {
            background: rgba(255, 51, 102, 0.2);
            color: #ff3366;
            border: 1px solid #ff3366;
        }

        .role-badge {
            padding: 6px 16px;
            border-radius: 25px;
            font-size: 0.88rem;
            font-weight: 700;
            margin-left: 12px;
        }

        .role-super {
            background: linear-gradient(135deg, #ff3366, #ff6b8a);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 51, 102, 0.4);
        }

        .role-admin {
            background: linear-gradient(135deg, #8a2be2 0%, #00bfff 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(138, 43, 226, 0.4);
        }

        .role-editor {
            background: linear-gradient(135deg, #ffa500, #ffb733);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 165, 0, 0.4);
        }

        /* ==================== ADMIN MANAGEMENT ==================== */
        .admin-list {
            display: grid;
            gap: 18px;
        }

        .admin-card {
            background: rgba(15, 15, 25, 0.85);
            padding: 24px;
            border-radius: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(138, 43, 226, 0.3);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            animation: adminSlide 0.5s ease-out;
            flex-wrap: wrap;
            gap: 15px;
        }

        @keyframes adminSlide {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .admin-card:hover {
            background: rgba(138, 43, 226, 0.15);
            box-shadow: 0 12px 40px rgba(138, 43, 226, 0.4);
            transform: translateY(-5px);
        }

        .admin-info {
            display: flex;
            align-items: center;
            gap: 18px;
        }

        .admin-avatar {
            width: 65px;
            height: 65px;
            border-radius: 50%;
            background: linear-gradient(135deg, #8a2be2 0%, #00bfff 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 800;
            font-size: 1.3rem;
            box-shadow: 0 6px 20px rgba(138, 43, 226, 0.5);
            overflow: hidden;
            border: 3px solid rgba(0, 191, 255, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .admin-avatar:hover {
            transform: scale(1.12) rotate(8deg);
            box-shadow: 0 8px 30px rgba(138, 43, 226, 0.7);
        }

        .admin-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .admin-details {
            color: #fff;
        }

        .admin-name {
            font-weight: 700;
            color: #00bfff;
            margin-bottom: 6px;
            font-size: 1.1rem;
        }

        .admin-username {
            color: #8a2be2;
            font-size: 0.95rem;
            font-weight: 600;
        }

        /* ==================== FILE UPLOAD AREAS ==================== */
        .photo-upload, .logo-upload {
            border: 2px dashed rgba(138, 43, 226, 0.5);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(10, 10, 20, 0.7);
        }

        .logo-upload {
            padding: 35px;
        }

        .photo-upload:hover, .logo-upload:hover {
            border-color: #00bfff;
            background: rgba(138, 43, 226, 0.15);
        }

        .photo-preview {
            width: 130px;
            height: 130px;
            margin: 18px auto;
            display: none;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid #8a2be2;
            box-shadow: 0 6px 20px rgba(138, 43, 226, 0.5);
        }

        .photo-preview.show {
            display: block;
            animation: photoZoom 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        @keyframes photoZoom {
            from { opacity: 0; transform: scale(0.5); }
            to { opacity: 1; transform: scale(1); }
        }

        .photo-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .logo-preview {
            max-width: 220px;
            max-height: 220px;
            margin: 18px auto;
            display: none;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(138, 43, 226, 0.5);
        }

        .logo-preview.show {
            display: block;
            animation: logoZoom 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        @keyframes logoZoom {
            from { opacity: 0; transform: scale(0.5); }
            to { opacity: 1; transform: scale(1); }
        }

        /* ==================== ACTIVITY LOG ==================== */
        .activity-log {
            background: rgba(15, 15, 25, 0.85);
            border-radius: 16px;
            padding: 24px;
            max-height: 550px;
            overflow-y: auto;
            border: 1px solid rgba(138, 43, 226, 0.3);
        }

        .activity-item {
            padding: 18px;
            background: rgba(10, 10, 20, 0.7);
            border-radius: 10px;
            margin-bottom: 12px;
            border-left: 4px solid #8a2be2;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            animation: logSlide 0.5s ease-out;
        }

        @keyframes logSlide {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .activity-item:hover {
            background: rgba(138, 43, 226, 0.15);
            transform: translateX(8px);
            border-left-color: #00bfff;
        }

        .activity-time {
            color: #8a2be2;
            font-size: 0.92rem;
            margin-bottom: 6px;
            font-weight: 600;
        }

        .activity-text {
            color: #00bfff;
            font-weight: 500;
        }

        /* ==================== MODAL ==================== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(8px);
        }

        .modal.active {
            display: flex;
            animation: modalFade 0.3s;
        }

        @keyframes modalFade {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: rgba(15, 15, 25, 0.98);
            border-radius: 20px;
            padding: 35px;
            max-width: 650px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(138, 43, 226, 0.4);
            box-shadow: 0 30px 80px rgba(138, 43, 226, 0.5);
            animation: modalScale 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        @keyframes modalScale {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 28px;
            padding-bottom: 18px;
            border-bottom: 2px solid rgba(138, 43, 226, 0.3);
        }

        .modal-header h3 {
            color: #00bfff;
            font-size: 1.6rem;
            font-weight: 800;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 2.2rem;
            cursor: pointer;
            color: #8a2be2;
            line-height: 1;
            transition: all 0.3s;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .close-modal:hover {
            color: #00bfff;
            transform: rotate(90deg);
            background: rgba(138, 43, 226, 0.2);
        }

        /* ==================== UTILITY CLASSES ==================== */
        .hidden {
            display: none !important;
        }

        /* ==================== RESPONSIVE DESIGN ==================== */
        @media (max-width: 768px) {
            .container {
                padding: 18px;
            }

            .navbar {
                padding: 18px;
                flex-direction: column;
                gap: 15px;
            }

            .section-header {
                flex-direction: column;
                gap: 18px;
                align-items: flex-start;
            }

            .stat-value {
                font-size: 2.2rem;
            }

            .results-table {
                font-size: 0.9rem;
            }

            .results-table th,
            .results-table td {
                padding: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-spinner"></div>
        <div class="loading-text">ğŸ”¥ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Firebase...</div>
    </div>

    <div class="login-container hidden" id="loginScreen">
        <div class="login-card">
            <div class="login-header">
                <h1>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ğŸ¯</h1>
                <p>Admin Dashboard</p>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… / Username</label>
                    <input type="text" id="username" required>
                </div>
                <div class="form-group">
                    <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± / Password</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit" class="btn-login">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ / Login</button>
                <div class="error-message" id="loginError">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©</div>
            </form>
        </div>
    </div>

    <div class="dashboard" id="dashboardScreen">
        <nav class="navbar">
            <div class="navbar-brand">ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</div>
            <div class="navbar-user">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">
                        <span id="userInitial">A</span>
                    </div>
                    <div>
                        <div class="user-name" id="userName">Admin</div>
                        <div class="user-role" id="userRole">Super Admin</div>
                    </div>
                </div>
                <button class="btn-logout" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
            </div>
        </nav>

        <div class="container">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('overview')">ğŸ“ˆ Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</button>
                <button class="tab" onclick="switchTab('questions')">â“ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</button>
                <button class="tab" onclick="switchTab('results')">ğŸ† Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
                <button class="tab" onclick="switchTab('codes')">ğŸ« Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
                <button class="tab" onclick="switchTab('admins')">ğŸ‘¥ Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†</button>
                <button class="tab" onclick="switchTab('organization')">ğŸ¢ Ø§Ù„Ù…Ø¤Ø³Ø³Ø©</button>
                <button class="tab" onclick="switchTab('logs')">ğŸ“ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</button>
                <button class="tab" onclick="switchTab('profile')">ğŸ‘¤ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</button>
            </div>

            <div class="tab-content active" id="overviewTab">
                <div class="section-header">
                    <h2>Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© / Overview</h2>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalQuestions">0</div>
                        <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© / Total Questions</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalResults">0</div>
                        <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ / Total Results</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalCodes">0</div>
                        <div class="stat-label">Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù…ØªØ§Ø­Ø© / Available Codes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avgScore">0%</div>
                        <div class="stat-label">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¯Ø±Ø¬Ø§Øª / Avg Score</div>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="questionsTab">
                <div class="section-header">
                    <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© / Question Management</h2>
                    <button class="btn btn-primary" onclick="openAddQuestionModal()">â• Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯</button>
                </div>
                <div class="question-list" id="questionList"></div>
            </div>

            <div class="tab-content" id="resultsTab">
                <div class="section-header">
                    <h2>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙŠÙ† / Participant Results</h2>
                    <button class="btn btn-success" onclick="exportResults()">ğŸ“¥ ØªØµØ¯ÙŠØ± Excel</button>
                </div>
                <div id="resultsContent"></div>
            </div>

            <div class="tab-content" id="codesTab">
                <div class="section-header">
                    <h2>Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ / Access Codes</h2>
                    <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                        <button class="btn btn-success" onclick="exportCodes()">ğŸ“¥ ØªØµØ¯ÙŠØ± Ø§Ù„Ø£ÙƒÙˆØ§Ø¯</button>
                        <button class="btn btn-warning" onclick="resetAllCodes()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙƒÙ„</button>
                    </div>
                </div>
                <div id="codesContent"></div>
            </div>

            <div class="tab-content" id="adminsTab">
                <div class="section-header">
                    <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ† / Admin Management</h2>
                    <button class="btn btn-primary" onclick="openAddAdminModal()">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±Ù</button>
                </div>
                <div class="admin-list" id="adminList"></div>
            </div>

            <div class="tab-content" id="organizationTab">
                <div class="section-header">
                    <h2>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø¤Ø³Ø³Ø© / Organization Info</h2>
                    <button class="btn btn-success" onclick="saveOrganization()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
                </div>
                <form id="orgForm" style="display: grid; gap: 22px;">
                    <div class="form-group">
                        <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø¤Ø³Ø³Ø© / Organization Name</label>
                        <input type="text" id="orgName" value="Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„Ù‚Ù‡Ø±Ø§ÙˆÙŠØ©">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„ÙˆØµÙ / Description</label>
                        <textarea id="orgDescription">Ù…Ø³Ø§Ø¨Ù‚Ø© Ø«Ù‚Ø§ÙÙŠØ© Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ Ø¹Ù† Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©</textarea>
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ / Email</label>
                        <input type="email" id="orgEmail" value="info@quiz.com">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ù‡Ø§ØªÙ / Phone</label>
                        <input type="tel" id="orgPhone" value="+20 123 456 7890">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ø´Ø¹Ø§Ø± / Logo</label>
                        <div class="logo-upload" onclick="document.getElementById('logoInput').click()">
                            <div style="color: #8a2be2; font-weight: 600;">ğŸ“· Ø§Ø¶ØºØ· Ø£Ùˆ Ø§Ø³Ø­Ø¨ Ø§Ù„Ø´Ø¹Ø§Ø± Ù‡Ù†Ø§ / Click or Drag logo here</div>
                            <img class="logo-preview" id="logoPreview" alt="Logo">
                            <input type="file" id="logoInput" accept="image/*" style="display: none;" onchange="previewLogo(event)">
                        </div>
                    </div>
                </form>
            </div>

            <div class="tab-content" id="logsTab">
                <div class="section-header">
                    <h2>Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª / Activity Logs</h2>
                    <button class="btn btn-warning" onclick="clearLogs()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</button>
                </div>
                <div class="activity-log" id="activityLog"></div>
            </div>

            <div class="tab-content" id="profileTab">
                <div class="section-header">
                    <h2>Ù…Ù„ÙÙŠ Ø§Ù„Ø´Ø®ØµÙŠ / My Profile</h2>
                    <button class="btn btn-success" onclick="saveProfile()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
                </div>
                <form id="profileForm" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 28px;">
                    <div>
                        <div class="form-group">
                            <label>Ø§Ù„Ø§Ø³Ù… / Name</label>
                            <input type="text" id="profileName">
                        </div>
                        <div class="form-group">
                            <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ±Ù‡)</label>
                            <input type="text" id="profileUsername" disabled>
                        </div>
                         <div class="form-group">
                            <label>Ø§Ù„Ø¯ÙˆØ± / Role</label>
                            <input type="text" id="profileRole" disabled>
                        </div>
                         <div class="form-group">
                            <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© / New Password</label>
                            <input type="password" id="profileNewPassword" placeholder="Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºØ§Ù‹ Ù„Ø¹Ø¯Ù… Ø§Ù„ØªØºÙŠÙŠØ±">
                        </div>
                         <div class="form-group">
                            <label>ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± / Confirm Password</label>
                            <input type="password" id="profileConfirmPassword" placeholder="ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©">
                        </div>
                    </div>
                    <div>
                         <div class="form-group">
                            <label>Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ© / Profile Photo</label>
                            <div class="photo-upload" onclick="document.getElementById('profilePhotoInput').click()">
                                <div style="color: #8a2be2; font-weight: 600;">ğŸ“· Ø§Ø¶ØºØ· Ù„ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø©</div>
                                <div class="photo-preview" id="profilePhotoPreview">
                                    <img id="profilePhotoImg" alt="Profile Photo">
                                </div>
                                <input type="file" id="profilePhotoInput" accept="image/*" style="display: none;" onchange="previewProfilePhoto(event)">
                            </div>
                        </div>
                    </div>
                </form>
            </div>

        </div>
    </div>

    <div class="modal" id="questionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯ / Add New Question</h3>
                <button class="close-modal" onclick="closeQuestionModal()">Ã—</button>
            </div>
            <form id="questionForm">
                <input type="hidden" id="editQuestionId">
                <div class="form-group">
                    <label>Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„ / Question Text</label>
                    <textarea id="questionText" required></textarea>
                </div>
                <div class="form-group">
                    <label>Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ø¯Ø¯ (Ø«ÙˆØ§Ù†ÙŠ) / Timeout (seconds)</label>
                    <input type="number" id="questionTimeout" value="15" min="5" max="60" required>
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª / Choices</label>
                    <div class="choices-editor" id="choicesEditor">
                        <div class="choice-editor">
                            <input type="radio" name="correctChoice" value="0" checked>
                            <input type="text" placeholder="Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± 1" required>
                            <button type="button" class="btn btn-danger" onclick="removeChoice(this)" style="padding: 8px 12px;">Ã—</button>
                        </div>
                        <div class="choice-editor">
                            <input type="radio" name="correctChoice" value="1">
                            <input type="text" placeholder="Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± 2" required>
                            <button type="button" class="btn btn-danger" onclick="removeChoice(this)" style="padding: 8px 12px;">Ã—</button>
                        </div>
                    </div>
                    <button type="button" class="btn btn-add-choice" onclick="addChoice()">â• Ø¥Ø¶Ø§ÙØ© Ø§Ø®ØªÙŠØ§Ø±</button>
                </div>
                <div class="form-group">
                    <label>ØµÙˆØ±Ø© Ø§Ù„Ø³Ø¤Ø§Ù„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) / Question Image (optional)</label>
                    <div class="photo-upload" onclick="document.getElementById('questionImageInput').click()">
                        <div style="color: #8a2be2; font-weight: 600;">ğŸ“· Ø§Ø¶ØºØ· Ø£Ùˆ Ø§Ø³Ø­Ø¨ Ø§Ù„ØµÙˆØ±Ø© Ù‡Ù†Ø§ / Click or Drag image here</div>
                        <img class="logo-preview" id="questionImagePreview" alt="Question Image" style="max-width: 100%; max-height: 300px; margin-top: 15px;">
                        <input type="file" id="questionImageInput" accept="image/*" style="display: none;" onchange="uploadQuestionImage(event)">
                    </div>
                </div>
                <button type="submit" class="btn btn-success" style="width: 100%;">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø³Ø¤Ø§Ù„</button>
            </form>
        </div>
    </div>

    <div class="modal" id="adminModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±Ù Ø¬Ø¯ÙŠØ¯ / Add New Admin</h3>
                <button class="close-modal" onclick="closeAdminModal()">Ã—</button>
            </div>
            <form id="adminForm">
                <div class="form-group">
                    <label>Ø§Ù„Ø§Ø³Ù… / Name</label>
                    <input type="text" id="adminName" required>
                </div>
                <div class="form-group">
                    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… / Username</label>
                    <input type="text" id="adminUsername" required>
                </div>
                <div class="form-group">
                    <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± / Password</label>
                    <input type="password" id="adminPassword" required>
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ø¯ÙˆØ± / Role</label>
                    <select id="adminRole">
                        <option value="editor">Ù…Ø­Ø±Ø± / Editor</option>
                        <option value="admin">Ù…Ø´Ø±Ù / Admin</option>
                        <option value="super">Ù…Ø´Ø±Ù Ø¹Ø§Ù… / Super Admin</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ© / Profile Photo</label>
                    <div class="photo-upload" onclick="document.getElementById('adminPhotoInput').click()">
                        <div style="color: #8a2be2; font-weight: 600;">ğŸ“· Ø§Ø¶ØºØ· Ù„Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© / Click to upload photo</div>
                        <div class="photo-preview" id="adminPhotoPreview">
                            <img id="adminPhotoImg" alt="Admin Photo">
                        </div>
                        <input type="file" id="adminPhotoInput" accept="image/*" style="display: none;" onchange="previewAdminPhoto(event)">
                    </div>
                </div>
                <button type="submit" class="btn btn-success" style="width: 100%;">â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø´Ø±Ù</button>
            </form>
        </div>
    </div>

    <script type="module">
        // ==================== FIREBASE CONFIGURATION ====================
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, get, update, remove, onValue, push } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        // ğŸ”¥ Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB07Y_PLpim4coY9zT0KxrhfmDLu-xe_bM",
            authDomain: "el-qaheraweya.firebaseapp.com",
            databaseURL: "https://el-qaheraweya-default-rtdb.firebaseio.com",
            projectId: "el-qaheraweya",
            storageBucket: "el-qaheraweya.appspot.com",
            messagingSenderId: "380945019833",
            appId: "1:380945019833:web:24f293bade8ea5ffdcfc68",
            measurementId: "G-9W4QNTF5CK"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Make Firebase available globally
        window.firebaseDB = {
            database,
            ref,
            set,
            get,
            update,
            remove,
            onValue,
            push
        };

        console.log('ğŸ”¥ Firebase initialized successfully!');
        
        // Initialize app data first
        initializeAppData().then(() => {
            // Hide loading screen
            document.getElementById('loadingScreen').style.display = 'none';
            document.getElementById('loginScreen').classList.remove('hidden');
        });
    </script>

    <script>
// ==================== CONSTANTS ====================
const VALID_CODES = ["QZ8K2M","QZ7N4P","QZ3R6T","QZ9W1Y","QZ5X8A","QZ2C4D","QZ6F7G","QZ1H9J","QZ4K3L","QZ8M5N","QZ7P2Q","QZ3R9S","QZ5T6V","QZ9W8X","QZ2Y1Z","QZ6A4B","QZ1C7D","QZ4E9F","QZ8G3H","QZ7J5K","QZ3L2M","QZ5N6P","QZ9Q8R","QZ2S1T","QZ6V4W","QZ1X7Y","QZ4Z9A","QZ8B3C","QZ7D5E","QZ3F2G","QZ5H6J","QZ9K8L","QZ2M1N","QZ6P4Q","QZ1R7S","QZ4T9V","QZ8W3X","QZ7Y5Z","QZ3A2B","QZ5C6D","QZ9E8F","QZ2G1H","QZ6J4K","QZ1L7M","QZ4N9P","QZ8Q3R","QZ7S5T","QZ3V2W","QZ5X6Y","QZ9Z8A","QZ2B1C","QZ6D4E","QZ1F7G","QZ4H9J","QZ8K3L","QZ7M5N","QZ3P2Q","QZ5R6S","QZ9T8V","QZ2W1X","QZ6Y4Z","QZ1A7B","QZ4C9D","QZ8E3F","QZ7G5H","QZ3J2K","QZ5L6M","QZ9N8P","QZ2Q1R","QZ6S4T","QZ1V7W","QZ4X9Y","QZ8Z3A","QZ7B5C","QZ3D2E","QZ5F6G","QZ9H8J","QZ2K1L","QZ6M4N","QZ1P7Q","QZ4R9S","QZ8T3V","QZ7W5X","QZ3Y2Z","QZ5A6B","QZ9C8D","QZ2E1F","QZ6G4H","QZ1J7K","QZ4L9M","QZ8N3P","QZ7Q5R","QZ3S2T","QZ5V6W","QZ9X8Y","QZ2Z1A","QZ6B4C","QZ1D7E","QZ4F9G","QZ8H3J","QZ7K5L","QZ3M2N","QZ5P6Q","QZ9R8S","QZ2T1V","QZ6W4X","QZ1Y7Z","QZ4A9B","QZ8C3D","QZ7E5F","QZ3G2H","QZ5J6K","QZ9L8M","QZ2N1P","QZ6Q4R","QZ1S7T","QZ4V9W","QZ8X3Y","QZ7Z5A","QZ3B2C","QZ5D6E","QZ9F8G","QZ2H1J","QZ6K4L","QZ1M7N","QZ4P9Q","QZ8R3S","QZ7T5V","QZ3W2X","QZ5Y6Z","QZ9A8B","QZ2C1D","QZ6E4F","QZ1G7H","QZ4J9K","QZ8L3M","QZ7N5P","QZ3Q2R","QZ5S6T","QZ9V8W","QZ2X1Y","QZ6Z4A","QZ1B7C","QZ4D9E","QZ8F3G","QZ7H5J","QZ3K2L","QZ5M6N","QZ9P8Q","QZ2R1S","QZ6T4V","QZ1W7X","QZ4Y9Z","QZ8A3B","QZ7C5D","QZ3E2F","QZ5G6H","QZ9J8K","QZ2L1M","QZ6N4P","QZ1Q7R","QZ4S9T","QZ8V3W","QZ7X5Y","QZ3Z2A","QZ5B6C","QZ9D8E","QZ2F1G","QZ6H4J","QZ1K7L","QZ4M9N","QZ8P3Q","QZ7R5S","QZ3T2V","QZ5W6X","QZ9Y8Z","QZ2A1B","QZ6C4D","QZ1E7F","QZ4G9H","QZ8J3K","QZ7L5M","QZ3N2P","QZ5Q6R","QZ9S8T","QZ2V1W","QZ6X4Y","QZ1Z7A","QZ4B9C","QZ8D3E","QZ7F5G","QZ3H2J","QZ5K6L","QZ9M8N","QZ2P1Q","QZ6R4S","QZ1T7V","QZ4W9X","QZ8Y3Z","QZ7A5B","QZ3C2D","QZ5E6F","QZ9G8H","QZ2J1K","QZ6L4M","QZ1N7P","QZ4Q9R","QZ8S3T","QZ7V5W","QZ3X2Y","QZ5Z6A","QZ9B8C","QZ2D1E","QZ6F4G","QZ1H7J","QZ4K9L","QZ8M3N","QZ7P5Q","QZ3R2S","QZ5T6V","QZ9W8X","QZ2Y1Z","QZ6A4B","QZ1C7D","QZ4E9F","QZ8G3H","QZ7J5K","QZ3L2M","QZ5N6P","QZ9Q8R","QZ2S1T","QZ6V4W","QZ1X7Y","QZ4Z9A","QZ8B3C","QZ7D5E","QZ3F2G","QZ5H6J","QZ9K8L","QZ2M1N","QZ6P4Q","QZ1R7S","QZ4T9V","QZ8W3X","QZ7Y5Z","QZ3A2B","QZ5C6D","QZ9E8F","QZ2G1H","QZ6J4K","QZ1L7M"];

// ==================== DATABASE ====================
const DB = {
    questions: [],
    results: [],
    admins: [],
    accessCodes: [],
    organization: {
        name: 'Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„Ù‚Ù‡Ø±Ø§ÙˆÙŠØ©',
        description: 'Ù…Ø³Ø§Ø¨Ù‚Ø© Ø«Ù‚Ø§ÙÙŠØ© Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ Ø¹Ù† Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©',
        email: 'info@quiz.com',
        phone: '+20 123 456 7890',
        logo: ''
    },
    activityLogs: []
};

// ==================== STATE VARIABLES ====================
let currentUser = null;
let editingQuestionId = null;
let currentAdminPhoto = null;
let currentQuestionImage = null;
let currentProfilePhoto = null;

// ==================== FIREBASE FUNCTIONS ====================
async function syncToFirebase(path, data) {
    try {
        const { database, ref, set } = window.firebaseDB;
        await set(ref(database, path), data);
        console.log('âœ… Synced to Firebase:', path);
    } catch (error) {
        console.error('âŒ Firebase sync error:', error);
        showAlert('error', 'ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸ / Save failed');
    }
}

async function loadFromFirebase(path) {
    try {
        const { database, ref, get } = window.firebaseDB;
        const snapshot = await get(ref(database, path));
        if (snapshot.exists()) {
            return snapshot.val();
        }
        return null;
    } catch (error) {
        console.error('âŒ Firebase load error:', error);
        return null;
    }
}

function listenToFirebase(path, callback) {
    try {
        const { database, ref, onValue } = window.firebaseDB;
        onValue(ref(database, path), (snapshot) => {
            if (snapshot.exists()) {
                callback(snapshot.val());
            } else {
                callback(null); // Pass null if data doesn't exist
            }
        });
    } catch (error) {
        console.error('âŒ Firebase listener error:', error);
    }
}

// ==================== INITIALIZATION ====================
async function initializeAppData() {
    await loadAdmins();
    await loadAccessCodes();
    await loadQuestions();
    await loadResults();
    await loadOrganization();
    await loadLogs();
    setupEventListeners();
    setupRealtimeListeners();
    console.log('âœ… App initialized successfully');
}

async function loadAdmins() {
    const admins = await loadFromFirebase('admins');
    if (admins) {
        DB.admins = Object.values(admins);
        console.log('âœ… Admins loaded from Firebase:', DB.admins.length);
    } else {
        // Initialize default admins if none exist on Firebase
        DB.admins = [
            { id: 1, name: 'Moreen Mamdouh', username: 'moreen', password: 'moreen1250', role: 'super', photo: 'https://i.imgur.com/example1.jpg' },
            { id: 2, name: 'Fady Samuel', username: 'fady', password: 'fady12903', role: 'admin', photo: 'https://i.imgur.com/example2.jpg' },
            { id: 3, name: 'Youssef Jacob', username: 'youssef', password: 'youssef96547', role: 'editor', photo: 'https://i.imgur.com/example3.jpg' }
        ];
        await saveAdmins();
    }
}

async function saveAdmins() {
    const adminsObj = {};
    DB.admins.forEach(admin => {
        adminsObj[admin.id] = admin;
    });
    await syncToFirebase('admins', adminsObj);
}

async function loadAccessCodes() {
    const codes = await loadFromFirebase('accessCodes');
    if (codes) {
        DB.accessCodes = Object.values(codes);
        console.log('âœ… Access codes loaded from Firebase:', DB.accessCodes.length);
    } else {
        // Initialize fresh codes
        DB.accessCodes = VALID_CODES.map(code => ({
            code: code,
            used: false,
            usedBy: null,
            usedAt: null
        }));
        await saveAccessCodes();
    }
}

async function saveAccessCodes() {
    const codesObj = {};
    DB.accessCodes.forEach((code, index) => {
        // Use the code string itself as the key for better management
        codesObj[code.code] = code;
    });
    await syncToFirebase('accessCodes', codesObj);
}


async function loadQuestions() {
    const questions = await loadFromFirebase('questions');
    if (questions) {
        DB.questions = Object.values(questions);
        console.log('âœ… Questions loaded from Firebase:', DB.questions.length);
    } else {
        // Initialize sample questions
        DB.questions = [
            { id: 1, text: "Ø¥ÙƒÙ„ÙŠØ³ÙŠØ§ ØªØ¹Ù†ÙŠ:", choices: ["Ø¬Ù…Ø§Ø¹Ø©", "Ø¨ÙŠØª", "Ù…ÙƒØ§Ù†"], correctChoice: 0, timeout: 15, image: null },
            { id: 2, text: "ÙƒØ§Ù… Ù…Ø±Ø© ÙˆØ±Ø¯Øª ÙƒÙ„Ù…Ø© ÙƒÙ†ÙŠØ³Ø© ÙÙŠ Ø§Ù„ÙƒØªØ§Ø¨ Ø§Ù„Ù…Ù‚Ø¯Ø³ØŸ", choices: ["72", "80", "77"], correctChoice: 2, timeout: 15, image: null },
            { id: 3, text: "Ù…Ù† Ø±Ù…ÙˆØ² Ø§Ù„ÙƒÙ†ÙŠØ³Ø©", choices: ["ÙÙ„Ùƒ Ù†ÙˆØ­", "Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù‚Ø¯Ø³Ø©", "Ø§Ù„Ø§Ø«Ù†ÙŠÙ† Ù…Ø¹Ø§"], correctChoice: 2, timeout: 15, image: null }
        ];
        await saveQuestions();
    }
}

async function saveQuestions() {
    const questionsObj = {};
    DB.questions.forEach(q => {
        questionsObj[q.id] = q;
    });
    await syncToFirebase('questions', questionsObj);
}

async function loadResults() {
    const results = await loadFromFirebase('results');
    if (results) {
        DB.results = Object.values(results);
        console.log('âœ… Results loaded from Firebase:', DB.results.length);
    }
}

async function saveResult(result) {
    await syncToFirebase(`results/${result.id}`, result);
}

async function loadOrganization() {
    const org = await loadFromFirebase('organization');
    if (org) {
        DB.organization = org;
        console.log('âœ… Organization loaded from Firebase');
    }
}

async function saveOrganizationData() {
    await syncToFirebase('organization', DB.organization);
}

async function loadLogs() {
    const logs = await loadFromFirebase('activityLogs');
    if (logs) {
        DB.activityLogs = Object.values(logs).sort((a, b) => b.id - a.id); // Sort by newest first
        console.log('âœ… Logs loaded from Firebase:', DB.activityLogs.length);
    }
}

async function saveLogs() {
    const logsObj = {};
    DB.activityLogs.forEach((log) => {
        logsObj[log.id] = log;
    });
    await syncToFirebase('activityLogs', logsObj);
}


// ==================== REALTIME LISTENERS ====================
function setupRealtimeListeners() {
    listenToFirebase('results', (data) => {
        DB.results = data ? Object.values(data) : [];
        updateStats();
        if (document.getElementById('resultsTab').classList.contains('active')) {
            displayResults();
        }
    });

    listenToFirebase('questions', (data) => {
        DB.questions = data ? Object.values(data) : [];
        updateStats();
        if (document.getElementById('questionsTab').classList.contains('active')) {
            displayQuestions();
        }
    });

    listenToFirebase('accessCodes', (data) => {
        DB.accessCodes = data ? Object.values(data) : [];
        updateStats();
        if (document.getElementById('codesTab').classList.contains('active')) {
            displayCodes();
        }
    });
    
    listenToFirebase('admins', (data) => {
        DB.admins = data ? Object.values(data) : [];
        if (document.getElementById('adminsTab').classList.contains('active')) {
            displayAdmins();
        }
    });

    console.log('âœ… Realtime listeners setup complete');
}


// ==================== EVENT LISTENERS ====================
function setupEventListeners() {
    document.getElementById('loginForm').addEventListener('submit', handleLogin);
    document.getElementById('questionForm').addEventListener('submit', handleQuestionSubmit);
    document.getElementById('adminForm').addEventListener('submit', handleAdminSubmit);
}


// ==================== LOGIN & LOGOUT ====================
function handleLogin(e) {
    e.preventDefault();
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value;

    const user = DB.admins.find(a => a.username === username && a.password === password);
    
    if (user) {
        currentUser = user;
        document.getElementById('loginScreen').classList.add('hidden');
        document.getElementById('dashboardScreen').classList.add('active');
        document.getElementById('userName').textContent = user.name;
        document.getElementById('userRole').textContent = getRoleLabel(user.role);
        
        const avatarElement = document.getElementById('userAvatar');
        if (user.photo) {
            avatarElement.innerHTML = `<img src="${user.photo}" alt="${user.name}">`;
        } else {
            avatarElement.innerHTML = `<span id="userInitial">${user.name.charAt(0).toUpperCase()}</span>`;
        }
        
        addLog(`ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ ${user.name}`, user.name);
        loadDashboard();
        console.log('âœ… Login successful:', user.name);
    } else {
        const errorMsg = document.getElementById('loginError');
        errorMsg.classList.add('show');
        setTimeout(() => errorMsg.classList.remove('show'), 3000);
    }
}

function logout() {
    if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ / Do you want to logout?')) {
        addLog(`ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ ${currentUser.name}`, currentUser.name);
        currentUser = null;
        document.getElementById('dashboardScreen').classList.remove('active');
        document.getElementById('loginScreen').classList.remove('hidden');
        document.getElementById('username').value = '';
        document.getElementById('password').value = '';
    }
}

// ==================== UTILITY FUNCTIONS ====================
function getRoleLabel(role) {
    const labels = { 
        'super': 'Super Admin', 
        'admin': 'Admin', 
        'editor': 'Editor' 
    };
    return labels[role] || role;
}

function showAlert(type, message) {
    const alert = document.createElement('div');
    alert.className = `alert alert-${type}`;
    alert.textContent = message;
    alert.style.position = 'fixed';
    alert.style.top = '20px';
    alert.style.right = '20px';
    alert.style.zIndex = '10000';
    alert.style.minWidth = '320px';
    
    document.body.appendChild(alert);
    
    setTimeout(() => {
        alert.style.transition = 'opacity 0.3s, transform 0.3s';
        alert.style.opacity = '0';
        alert.style.transform = 'translateY(-20px)';
        setTimeout(() => alert.remove(), 300);
    }, 3000);
}

async function addLog(message, user) {
    const log = { 
        id: Date.now(),
        message, 
        user, 
        timestamp: new Date().toISOString()
    };
    DB.activityLogs.unshift(log);
    
    if (DB.activityLogs.length > 100) {
        DB.activityLogs = DB.activityLogs.slice(0, 100);
    }
    
    await syncToFirebase(`activityLogs/${log.id}`, log);
}


function escapeHtml(text) {
    if (typeof text !== 'string') return '';
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}


// ==================== TAB NAVIGATION ====================
function switchTab(tabName) {
    document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
    
    event.target.classList.add('active');
    document.getElementById(tabName + 'Tab').classList.add('active');
    
    switch(tabName) {
        case 'questions': displayQuestions(); break;
        case 'results': displayResults(); break;
        case 'codes': displayCodes(); break;
        case 'admins': displayAdmins(); break;
        case 'logs': displayLogs(); break;
        case 'organization': loadOrgData(); break;
        case 'overview': updateStats(); break;
        case 'profile': loadProfileData(); break;
    }
}

function loadDashboard() {
    updateStats();
    // No need to load all tabs at once, switchTab will handle it.
}


// ==================== STATS ====================
function updateStats() {
    document.getElementById('totalQuestions').textContent = DB.questions.length;
    document.getElementById('totalResults').textContent = DB.results.length;
    
    const availableCount = DB.accessCodes.filter(c => !c.used).length;
    document.getElementById('totalCodes').textContent = availableCount;
    
    if (DB.results.length > 0) {
        const totalPercentage = DB.results.reduce((sum, r) => sum + r.percentage, 0);
        const avgPercentage = Math.round(totalPercentage / DB.results.length);
        document.getElementById('avgScore').textContent = avgPercentage + '%';
    } else {
        document.getElementById('avgScore').textContent = '0%';
    }
}

// ==================== QUESTIONS MANAGEMENT ====================
function displayQuestions() {
    const questionList = document.getElementById('questionList');
    questionList.innerHTML = '';
    
    if (DB.questions.length === 0) {
        questionList.innerHTML = '<p style="text-align: center; color: #8a2be2; padding: 50px; font-size: 1.1rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ø­Ø§Ù„ÙŠØ§Ù‹ / No questions yet</p>';
        return;
    }
    
    DB.questions.forEach(q => {
        const card = document.createElement('div');
        card.className = 'question-card';
        card.innerHTML = `
            <div class="question-header">
                <span class="question-id">Ø§Ù„Ø³Ø¤Ø§Ù„ #${q.id}</span>
                <div class="question-actions">
                    <button class="btn btn-warning" onclick="editQuestion(${q.id})" style="padding: 10px 18px;">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
                    <button class="btn btn-danger" onclick="deleteQuestion(${q.id})" style="padding: 10px 18px;">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                </div>
            </div>
            <div class="question-text">${escapeHtml(q.text)}</div>
            ${q.image ? `<img src="${q.image}" style="max-width: 200px; border-radius: 12px; margin: 12px 0; border: 2px solid #8a2be2;" alt="Question Image">` : ''}
            <div class="choices-list">
                ${q.choices.map((choice, i) => `
                    <div class="choice-item ${i === q.correctChoice ? 'correct' : ''}">
                        <span class="choice-badge">${String.fromCharCode(65 + i)}</span>
                        <span class="choice-text">${escapeHtml(choice)}</span>
                        ${i === q.correctChoice ? '<span class="correct-badge">âœ“ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©</span>' : ''}
                    </div>
                `).join('')}
            </div>
            <div style="color: #8a2be2; font-size: 0.95rem; margin-top: 12px; font-weight: 600;">
                â±ï¸ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ø¯Ø¯: ${q.timeout} Ø«Ø§Ù†ÙŠØ©
            </div>
        `;
        questionList.appendChild(card);
    });
}

async function handleQuestionSubmit(e) {
    e.preventDefault();
    
    const text = document.getElementById('questionText').value.trim();
    const timeout = parseInt(document.getElementById('questionTimeout').value);
    
    const choiceEditors = document.querySelectorAll('.choice-editor');
    const choices = Array.from(choiceEditors).map(editor => 
        editor.querySelector('input[type="text"]').value.trim()
    );
    
    const correctChoiceRadio = document.querySelector('input[name="correctChoice"]:checked');
    if (!correctChoiceRadio) {
        showAlert('error', 'ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© / Please select correct answer');
        return;
    }
    
    const correctChoice = parseInt(correctChoiceRadio.value);
    
    if (editingQuestionId) {
        const question = DB.questions.find(q => q.id === editingQuestionId);
        if (question) {
            question.text = text;
            question.choices = choices;
            question.correctChoice = correctChoice;
            question.timeout = timeout;
            
            if (currentQuestionImage) {
                question.image = currentQuestionImage;
            }
            
            await saveQuestions();
            addLog(`ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¤Ø§Ù„ #${editingQuestionId}`, currentUser.name);
            showAlert('success', 'ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­ / Question updated successfully');
        }
    } else {
        const newId = DB.questions.length > 0 ? Math.max(...DB.questions.map(q => q.id)) + 1 : 1;
        const newQuestion = {
            id: newId,
            text,
            choices,
            correctChoice,
            timeout,
            image: currentQuestionImage || null
        };
        
        DB.questions.push(newQuestion);
        await saveQuestions();
        addLog(`ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯ #${newId}`, currentUser.name);
        showAlert('success', 'ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­ / Question added successfully');
    }
    
    closeQuestionModal();
    displayQuestions();
    updateStats();
}

function openAddQuestionModal() {
    if (!hasPermission(['editor', 'admin', 'super'])) {
        showAlert('error', 'Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© / No permission');
        return;
    }
    
    editingQuestionId = null;
    currentQuestionImage = null;
    document.getElementById('modalTitle').textContent = 'Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯ / Add New Question';
    document.getElementById('questionForm').reset();
    
    const imagePreview = document.getElementById('questionImagePreview');
    imagePreview.src = '';
    imagePreview.style.display = 'none';

    const editor = document.getElementById('choicesEditor');
    editor.innerHTML = `
        <div class="choice-editor">
            <input type="radio" name="correctChoice" value="0" checked>
            <input type="text" placeholder="Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± 1" required>
            <button type="button" class="btn btn-danger" onclick="removeChoice(this)" style="padding: 8px 12px;">Ã—</button>
        </div>
        <div class="choice-editor">
            <input type="radio" name="correctChoice" value="1">
            <input type="text" placeholder="Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± 2" required>
            <button type="button" class="btn btn-danger" onclick="removeChoice(this)" style="padding: 8px 12px;">Ã—</button>
        </div>
    `;
    
    document.getElementById('questionModal').classList.add('active');
}

function editQuestion(id) {
    if (!hasPermission(['editor', 'admin', 'super'])) {
        showAlert('error', 'Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© / No permission');
        return;
    }
    
    const question = DB.questions.find(q => q.id === id);
    if (!question) return;
    
    editingQuestionId = id;
    currentQuestionImage = question.image || null;
    
    document.getElementById('modalTitle').textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¤Ø§Ù„ / Edit Question';
    document.getElementById('questionText').value = question.text;
    document.getElementById('questionTimeout').value = question.timeout;
    
    const imagePreview = document.getElementById('questionImagePreview');
    if (question.image) {
        imagePreview.src = question.image;
        imagePreview.style.display = 'block';
    } else {
        imagePreview.src = '';
        imagePreview.style.display = 'none';
    }
    
    const editor = document.getElementById('choicesEditor');
    editor.innerHTML = question.choices.map((choice, i) => `
        <div class="choice-editor">
            <input type="radio" name="correctChoice" value="${i}" ${i === question.correctChoice ? 'checked' : ''}>
            <input type="text" placeholder="Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± ${i + 1}" value="${escapeHtml(choice)}" required>
            <button type="button" class="btn btn-danger" onclick="removeChoice(this)" style="padding: 8px 12px;">Ã—</button>
        </div>
    `).join('');
    
    document.getElementById('questionModal').classList.add('active');
}

function closeQuestionModal() {
    document.getElementById('questionModal').classList.remove('active');
    editingQuestionId = null;
    currentQuestionImage = null;
}

function addChoice() {
    const editor = document.getElementById('choicesEditor');
    const index = editor.children.length;
    const div = document.createElement('div');
    div.className = 'choice-editor';
    div.innerHTML = `
        <input type="radio" name="correctChoice" value="${index}">
        <input type="text" placeholder="Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± ${index + 1}" required>
        <button type="button" class="btn btn-danger" onclick="removeChoice(this)" style="padding: 8px 12px;">Ã—</button>
    `;
    editor.appendChild(div);
}

function removeChoice(btn) {
    const editor = document.getElementById('choicesEditor');
    if (editor.children.length <= 2) {
        showAlert('error', 'ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù‡Ù†Ø§Ùƒ Ø§Ø®ØªÙŠØ§Ø±Ø§Ù† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ / Must have at least 2 choices');
        return;
    }
    btn.parentElement.remove();
    
    Array.from(editor.children).forEach((child, i) => {
        child.querySelector('input[type="radio"]').value = i;
        child.querySelector('input[type="text"]').placeholder = `Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± ${i + 1}`;
    });
}

function uploadQuestionImage(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    if (file.size > 5 * 1024 * 1024) {
        showAlert('error', 'Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹! Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 5MB / Image too large! Max 5MB');
        event.target.value = '';
        return;
    }
    
    const reader = new FileReader();
    reader.onload = function(e) {
        currentQuestionImage = e.target.result;
        const imagePreview = document.getElementById('questionImagePreview');
        imagePreview.src = e.target.result;
        imagePreview.style.display = 'block';
    };
    reader.readAsDataURL(file);
}

async function deleteQuestion(id) {
    if (!hasPermission(['admin', 'super'])) {
        showAlert('error', 'Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„Ø­Ø°Ù Ø§Ù„Ø£Ø³Ø¦Ù„Ø© / You do not have permission');
        return;
    }
    
    if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¤Ø§Ù„ØŸ / Are you sure?')) {
        DB.questions = DB.questions.filter(q => q.id !== id);
        await saveQuestions();
        addLog(`ØªÙ… Ø­Ø°Ù Ø§Ù„Ø³Ø¤Ø§Ù„ #${id}`, currentUser.name);
        displayQuestions();
        updateStats();
        showAlert('success', 'ØªÙ… Ø­Ø°Ù Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­ / Question deleted successfully');
    }
}


// ==================== RESULTS MANAGEMENT ====================
function displayResults() {
    const resultsContent = document.getElementById('resultsContent');
    
    if (DB.results.length === 0) {
        resultsContent.innerHTML = '<p style="text-align: center; color: #8a2be2; padding: 50px; font-size: 1.1rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ø­Ø§Ù„ÙŠØ§Ù‹ / No results yet</p>';
        return;
    }
    
    const sortedResults = [...DB.results].sort((a, b) => b.score - a.score);
    
    resultsContent.innerHTML = `
        <table class="results-table">
            <thead>
                <tr>
                    <th>Ø§Ù„ØªØ±ØªÙŠØ¨</th>
                    <th>Ø§Ù„Ø§Ø³Ù…</th>
                    <th>Ø§Ù„ÙƒÙˆØ¯</th>
                    <th>Ø§Ù„Ù†ØªÙŠØ¬Ø©</th>
                    <th>Ø§Ù„Ù†Ø³Ø¨Ø©</th>
                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
            </thead>
            <tbody>
                ${sortedResults.map((result, index) => `
                    <tr>
                        <td><strong>${index + 1}</strong></td>
                        <td>${escapeHtml(result.name)}</td>
                        <td><strong style="color: #00bfff;">${result.code}</strong></td>
                        <td>${result.score} / ${result.total}</td>
                        <td><span class="score-badge ${result.percentage >= 85 ? 'score-excellent' : result.percentage >= 70 ? 'score-good' : result.percentage >= 50 ? 'score-average' : 'score-poor'}">${result.percentage}%</span></td>
                        <td>${new Date(result.date).toLocaleString('ar-EG')}</td>
                        <td>
                            <button class="btn btn-danger" onclick="deleteResult('${result.id}')" style="padding: 6px 14px; font-size: 0.9rem;">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                        </td>
                    </tr>
                `).join('')}
            </tbody>
        </table>
    `;
}

async function deleteResult(id) {
    if (!hasPermission(['super', 'admin'])) {
        showAlert('error', 'Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„Ø­Ø°Ù Ø§Ù„Ù†ØªØ§Ø¦Ø¬ / You do not have permission');
        return;
    }
    
    if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù†ØªÙŠØ¬Ø©ØŸ\nØ³ÙŠØªÙ… Ø£ÙŠØ¶Ø§Ù‹ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…Ø±ØªØ¨Ø· Ø¨Ù‡Ø§\n\nAre you sure?\nThe associated code will also be reset')) {
        const result = DB.results.find(r => r.id === id);
        if (!result) return;
        
        DB.results = DB.results.filter(r => r.id !== id);
        const { database, ref, remove } = window.firebaseDB;
        await remove(ref(database, `results/${id}`));
        
        const codeObj = DB.accessCodes.find(c => c.code === result.code);
        if (codeObj) {
            codeObj.used = false;
            codeObj.usedBy = null;
            codeObj.usedAt = null;
            await saveAccessCodes();
        }
        
        addLog(`ØªÙ… Ø­Ø°Ù Ù†ØªÙŠØ¬Ø© ${result.name}`, currentUser.name);
        showAlert('success', 'ØªÙ… Ø­Ø°Ù Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙˆØ¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙƒÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­ / Result deleted and code reset successfully');
    }
}


function exportResults() {
    if (DB.results.length === 0) {
        showAlert('error', 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù„ØªØµØ¯ÙŠØ± / No results to export');
        return;
    }
    
    const csv = [
        ['Ø§Ù„ØªØ±ØªÙŠØ¨', 'Ø§Ù„Ø§Ø³Ù…', 'Ø§Ù„ÙƒÙˆØ¯', 'Ø§Ù„Ù†ØªÙŠØ¬Ø©', 'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹', 'Ø§Ù„Ù†Ø³Ø¨Ø©', 'Ø§Ù„ØªØ§Ø±ÙŠØ®'],
        ...DB.results
            .sort((a, b) => b.score - a.score)
            .map((r, i) => [
                i + 1,
                r.name,
                r.code,
                r.score,
                r.total,
                r.percentage + '%',
                new Date(r.date).toLocaleString('ar-EG')
            ])
    ].map(row => row.join(',')).join('\n');
    
    const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'quiz_results_' + Date.now() + '.csv';
    link.click();
    
    addLog('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬', currentUser.name);
    showAlert('success', 'ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¨Ù†Ø¬Ø§Ø­ / Results exported successfully');
}


// ==================== ACCESS CODES ====================
function displayCodes() {
    const codesContent = document.getElementById('codesContent');
    
    const usedCodes = DB.accessCodes.filter(c => c.used);
    const availableCodes = DB.accessCodes.filter(c => !c.used);

    codesContent.innerHTML = `
        <div style="margin-bottom: 30px;">
            <h3 style="color: #ff3366; margin-bottom: 20px; font-size: 1.5rem;">Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© (${usedCodes.length})</h3>
            ${usedCodes.length > 0 ? `
                <table class="codes-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Ø§Ù„ÙƒÙˆØ¯</th>
                            <th>Ø§Ù„Ø§Ø³Ù…</th>
                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${usedCodes.map((item, index) => `
                            <tr>
                                <td><strong>${index + 1}</strong></td>
                                <td><strong style="color: #00bfff;">${item.code}</strong></td>
                                <td>${escapeHtml(item.usedBy)}</td>
                                <td>${new Date(item.usedAt).toLocaleString('ar-EG')}</td>
                                <td><span class="status-badge status-used">Ù…Ø³ØªØ®Ø¯Ù… / Used</span></td>
                                <td>
                                    <button class="btn btn-warning" onclick="resetCode('${item.code}')" style="padding: 6px 14px; font-size: 0.9rem;">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            ` : '<p style="text-align: center; color: #8a2be2; padding: 30px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙƒÙˆØ§Ø¯ Ù…Ø³ØªØ®Ø¯Ù…Ø©</p>'}
        </div>

        <div>
            <h3 style="color: #00bfff; margin-bottom: 20px; font-size: 1.5rem;">Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù…ØªØ§Ø­Ø© (${availableCodes.length})</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; padding: 20px; background: rgba(15, 15, 25, 0.85); border-radius: 16px;">
                ${availableCodes.map(item => `
                    <div style="background: rgba(0, 191, 255, 0.1); padding: 12px; border-radius: 10px; text-align: center; border: 2px solid rgba(0, 191, 255, 0.3); font-weight: 700; color: #00bfff;">
                        ${item.code}
                    </div>
                `).join('')}
            </div>
        </div>
    `;
}

async function resetCode(code) {
    if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙƒÙˆØ¯ ${code}ØŸ\nAre you sure you want to reset code ${code}?`)) {
        const codeObj = DB.accessCodes.find(c => c.code === code);
        if (codeObj) {
            codeObj.used = false;
            codeObj.usedBy = null;
            codeObj.usedAt = null;
            await saveAccessCodes();
        }
        
        addLog(`ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙƒÙˆØ¯ ${code}`, currentUser.name);
        showAlert('success', `ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙƒÙˆØ¯ ${code} Ø¨Ù†Ø¬Ø§Ø­ / Code ${code} reset successfully`);
    }
}

async function resetAllCodes() {
    if (confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ØŸ\nÙ‡Ø°Ø§ Ø³ÙŠØ³Ù…Ø­ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰!\n\nAre you sure you want to reset ALL codes?\nThis will allow them to be used again!')) {
        DB.accessCodes.forEach(codeObj => {
            codeObj.used = false;
            codeObj.usedBy = null;
            codeObj.usedAt = null;
        });
        await saveAccessCodes();
        
        addLog('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯', currentUser.name);
        showAlert('success', 'ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø¨Ù†Ø¬Ø§Ø­ / All codes reset successfully');
    }
}

function exportCodes() {
    const csv = [
        ['Ø§Ù„ÙƒÙˆØ¯', 'Ø§Ù„Ø­Ø§Ù„Ø©', 'Ø§Ù„Ø§Ø³Ù…', 'Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª'],
        ...DB.accessCodes.map(item => [
            item.code, 
            item.used ? 'Ù…Ø³ØªØ®Ø¯Ù…' : 'Ù…ØªØ§Ø­', 
            item.usedBy || '-', 
            item.usedAt ? new Date(item.usedAt).toLocaleString('ar-EG') : '-'
        ])
    ].map(row => row.join(',')).join('\n');
    
    const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'quiz_codes_' + Date.now() + '.csv';
    link.click();
    
    addLog('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø£ÙƒÙˆØ§Ø¯', currentUser.name);
    showAlert('success', 'ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø¨Ù†Ø¬Ø§Ø­ / Codes exported successfully');
}


// ==================== ADMIN MANAGEMENT ====================
function displayAdmins() {
    const adminList = document.getElementById('adminList');
    
    if (DB.admins.length === 0) {
        adminList.innerHTML = '<p style="text-align: center; color: #8a2be2; padding: 50px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´Ø±ÙÙŠÙ†</p>';
        return;
    }

    adminList.innerHTML = DB.admins.map(admin => `
        <div class="admin-card">
            <div class="admin-info">
                <div class="admin-avatar">
                    ${admin.photo ? `<img src="${admin.photo}" alt="${admin.name}">` : admin.name.charAt(0).toUpperCase()}
                </div>
                <div class="admin-details">
                    <div class="admin-name">${escapeHtml(admin.name)}</div>
                    <div class="admin-username">@${escapeHtml(admin.username)}</div>
                </div>
                <span class="role-badge role-${admin.role}">
                    ${getRoleLabel(admin.role)}
                </span>
            </div>
            <div>
                ${admin.id !== currentUser.id && currentUser.role === 'super' ? 
                    `<button class="btn btn-danger" onclick="deleteAdmin(${admin.id})" style="padding: 10px 20px;">ğŸ—‘ï¸ Ø­Ø°Ù</button>` : 
                    (admin.id === currentUser.id ? '<span style="color: #00bfff; font-weight: 600;">(you)</span>' : '')}
            </div>
        </div>
    `).join('');
}


function openAddAdminModal() {
    if (!hasPermission(['super'])) {
        showAlert('error', 'Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙÙŠÙ† / You do not have permission');
        return;
    }
    
    currentAdminPhoto = null;
    document.getElementById('adminForm').reset();
    
    const photoPreview = document.getElementById('adminPhotoPreview');
    photoPreview.classList.remove('show');
    
    document.getElementById('adminModal').classList.add('active');
}

function closeAdminModal() {
    document.getElementById('adminModal').classList.remove('active');
    currentAdminPhoto = null;
}

async function handleAdminSubmit(e) {
    e.preventDefault();
    
    const name = document.getElementById('adminName').value.trim();
    const username = document.getElementById('adminUsername').value.trim();
    const password = document.getElementById('adminPassword').value;
    const role = document.getElementById('adminRole').value;
    
    if (DB.admins.find(a => a.username === username)) {
        showAlert('error', 'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„ / Username already exists');
        return;
    }
    
    const newId = DB.admins.length > 0 ? Math.max(...DB.admins.map(a => a.id)) + 1 : 1;
    const newAdmin = { 
        id: newId, 
        name, 
        username, 
        password, 
        role,
        photo: currentAdminPhoto
    };
    
    DB.admins.push(newAdmin);
    await saveAdmins();
    
    addLog(`ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø´Ø±Ù ${name}`, currentUser.name);
    closeAdminModal();
    displayAdmins();
    showAlert('success', `ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø´Ø±Ù ${name} Ø¨Ù†Ø¬Ø§Ø­ / Admin ${name} added successfully`);
}

function previewAdminPhoto(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    if (file.size > 2 * 1024 * 1024) {
        showAlert('error', 'Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹! Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 2MB / Image too large! Max 2MB');
        event.target.value = '';
        return;
    }
    
    const reader = new FileReader();
    reader.onload = function(e) {
        currentAdminPhoto = e.target.result;
        const preview = document.getElementById('adminPhotoPreview');
        const img = document.getElementById('adminPhotoImg');
        img.src = e.target.result;
        preview.classList.add('show');
    };
    reader.readAsDataURL(file);
}

async function deleteAdmin(id) {
    if (!hasPermission(['super'])) {
        showAlert('error', 'Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„Ø­Ø°Ù Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ† / You do not have permission');
        return;
    }
    
    const admin = DB.admins.find(a => a.id === id);
    if (!admin) return;
    
    if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ø´Ø±Ù ${admin.name}ØŸ\nAre you sure you want to delete admin ${admin.name}?`)) {
        DB.admins = DB.admins.filter(a => a.id !== id);
        await saveAdmins();
        
        addLog(`ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø´Ø±Ù ${admin.name}`, currentUser.name);
        displayAdmins();
        showAlert('success', `ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø´Ø±Ù ${admin.name} Ø¨Ù†Ø¬Ø§Ø­ / Admin ${admin.name} deleted successfully`);
    }
}


// ==================== ACTIVITY LOGS ====================
function displayLogs() {
    const activityLog = document.getElementById('activityLog');
    
    if (DB.activityLogs.length === 0) {
        activityLog.innerHTML = '<p style="text-align: center; color: #8a2be2; padding: 50px; font-size: 1.1rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª / No logs yet</p>';
        return;
    }
    
    activityLog.innerHTML = DB.activityLogs.map(log => `
        <div class="activity-item">
            <div class="activity-time">${new Date(log.timestamp).toLocaleString('ar-EG')}</div>
            <div class="activity-text"><strong>${escapeHtml(log.user)}:</strong> ${escapeHtml(log.message)}</div>
        </div>
    `).join('');
}

async function clearLogs() {
    if (!hasPermission(['super'])) {
        showAlert('error', 'Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© / No permission');
        return;
    }
    
    if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§ØªØŸ / Are you sure?')) {
        DB.activityLogs = [];
        const { database, ref, set } = window.firebaseDB;
        await set(ref(database, 'activityLogs'), null); // Clear from firebase
        
        addLog('ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª', currentUser.name);
        displayLogs();
        showAlert('success', 'ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ / Logs cleared successfully');
    }
}


// ==================== ORGANIZATION ====================
function loadOrgData() {
    document.getElementById('orgName').value = DB.organization.name || '';
    document.getElementById('orgDescription').value = DB.organization.description || '';
    document.getElementById('orgEmail').value = DB.organization.email || '';
    document.getElementById('orgPhone').value = DB.organization.phone || '';
    
    const preview = document.getElementById('logoPreview');
    if (DB.organization.logo) {
        preview.src = DB.organization.logo;
        preview.classList.add('show');
    } else {
        preview.classList.remove('show');
    }
}

async function saveOrganization() {
    DB.organization.name = document.getElementById('orgName').value.trim();
    DB.organization.description = document.getElementById('orgDescription').value.trim();
    DB.organization.email = document.getElementById('orgEmail').value.trim();
    DB.organization.phone = document.getElementById('orgPhone').value.trim();
    
    await saveOrganizationData();
    addLog('ØªÙ… ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø¤Ø³Ø³Ø©', currentUser.name);
    showAlert('success', 'ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ / Changes saved successfully');
}

function previewLogo(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    if (file.size > 3 * 1024 * 1024) {
        showAlert('error', 'Ø­Ø¬Ù… Ø§Ù„Ø´Ø¹Ø§Ø± ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹! Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 3MB / Logo too large! Max 3MB');
        event.target.value = '';
        return;
    }
    
    const reader = new FileReader();
    reader.onload = async function(e) {
        const preview = document.getElementById('logoPreview');
        preview.src = e.target.result;
        preview.classList.add('show');
        DB.organization.logo = e.target.result;
        // The logo is saved immediately on upload
        await saveOrganizationData(); 
        showAlert('success', 'ØªÙ… Ø±ÙØ¹ Ø§Ù„Ø´Ø¹Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­ / Logo uploaded successfully');
    };
    reader.readAsDataURL(file);
}


// ==================== PROFILE MANAGEMENT ====================
function loadProfileData() {
    if (!currentUser) return;
    
    document.getElementById('profileName').value = currentUser.name || '';
    document.getElementById('profileUsername').value = currentUser.username || '';
    document.getElementById('profileRole').value = getRoleLabel(currentUser.role);
    document.getElementById('profileNewPassword').value = '';
    document.getElementById('profileConfirmPassword').value = '';
    
    const preview = document.getElementById('profilePhotoPreview');
    const img = document.getElementById('profilePhotoImg');
    
    if (currentUser.photo) {
        img.src = currentUser.photo;
        preview.classList.add('show');
        currentProfilePhoto = currentUser.photo;
    } else {
        img.src = '';
        preview.classList.remove('show');
        currentProfilePhoto = null;
    }
}

function previewProfilePhoto(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    if (file.size > 2 * 1024 * 1024) {
        showAlert('error', 'Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹! Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 2MB / Image too large! Max 2MB');
        event.target.value = '';
        return;
    }
    
    const reader = new FileReader();
    reader.onload = function(e) {
        currentProfilePhoto = e.target.result;
        const preview = document.getElementById('profilePhotoPreview');
        const img = document.getElementById('profilePhotoImg');
        img.src = e.target.result;
        preview.classList.add('show');
    };
    reader.readAsDataURL(file);
}

async function saveProfile() {
    if (!currentUser) return;
    
    const newName = document.getElementById('profileName').value.trim();
    const newPassword = document.getElementById('profileNewPassword').value;
    const confirmPassword = document.getElementById('profileConfirmPassword').value;
    
    if (!newName) {
        showAlert('error', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… / Please enter name');
        return;
    }
    
    // Check if password fields are filled and match
    if (newPassword || confirmPassword) {
        if (newPassword !== confirmPassword) {
            showAlert('error', 'ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø© / Passwords do not match');
            return;
        }
        
        if (newPassword.length < 6) {
            showAlert('error', 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ / Password must be at least 6 characters');
            return;
        }
    }
    
    // Update user data
    currentUser.name = newName;
    currentUser.photo = currentProfilePhoto;
    if (newPassword) {
        currentUser.password = newPassword;
    }
    
    // Update in DB.admins array
    const adminIndex = DB.admins.findIndex(a => a.id === currentUser.id);
    if (adminIndex !== -1) {
        DB.admins[adminIndex] = { ...currentUser };
    }
    
    // Save to Firebase
    await saveAdmins();
    
    // Update navbar display
    document.getElementById('userName').textContent = currentUser.name;
    const userAvatarElement = document.getElementById('userAvatar');
    if (currentUser.photo) {
        userAvatarElement.innerHTML = `<img src="${currentUser.photo}" alt="${currentUser.name}">`;
    } else {
        userAvatarElement.innerHTML = `<span id="userInitial">${currentUser.name.charAt(0).toUpperCase()}</span>`;
    }
    
    addLog('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ', currentUser.name);
    showAlert('success', 'ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ / Profile updated successfully');
    
    // Clear password fields
    document.getElementById('profileNewPassword').value = '';
    document.getElementById('profileConfirmPassword').value = '';
}


// ==================== HELPER FUNCTIONS ====================
function hasPermission(allowedRoles) {
    return currentUser && allowedRoles.includes(currentUser.role);
}

    </script>
</body>
</html>
